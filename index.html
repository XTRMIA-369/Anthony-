<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ONLYQ â€” Living Grid</title>

<style>
:root{
  --bg1:#2a0718;
  --bg2:#5a1734;
  --rose:#ff6fae;
  --rose-soft:#f3a7c7;
  --ink:#ffffff;
  --ink-dim:#d8a9be;
}

/* RESET */
*{margin:0;padding:0;box-sizing:border-box}
html,body{
  height:100%;
  overflow:hidden;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
}

/* BACKGROUND */
body{
  background:
    radial-gradient(800px 600px at 50% 20%, rgba(255,110,170,.28), transparent 60%),
    linear-gradient(160deg,var(--bg1),var(--bg2));
  color:var(--ink);
}

/* HEADER */
.header{
  padding-top:calc(env(safe-area-inset-top) + 14px);
  text-align:center;
}
.sup{
  font-size:11px;
  letter-spacing:.4em;
  color:var(--rose-soft);
}
h1{
  margin-top:6px;
  font-size:clamp(28px,9vw,48px);
  letter-spacing:.25em;
}
h1 span{color:var(--rose)}
.sub{
  margin-top:6px;
  font-size:12px;
  letter-spacing:.3em;
  color:var(--ink-dim);
}

/* SCENE */
.scene{
  height:70vh;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}

/* GRID */
.grid{
  display:grid;
  gap:5vw;
  width:100%;
  height:100%;
  padding:5vw;
  transition:.6s ease;
}
.grid.solo{grid-template-columns:1fr}
.grid.duo{grid-template-columns:1fr 1fr}
.grid.quad{grid-template-columns:1fr 1fr}

/* NODE */
.node{
  aspect-ratio:1/1;
  border-radius:26px;
  background:
    linear-gradient(180deg,rgba(0,0,0,.4),rgba(0,0,0,.85));
  border:2px solid rgba(255,127,191,.35);
  box-shadow:
    0 0 36px rgba(255,111,174,.25),
    inset 0 0 26px rgba(255,120,170,.25);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:4rem;
  animation:breathe 4.8s ease-in-out infinite;
}

/* BREATH */
@keyframes breathe{
  0%{transform:scale(1)}
  50%{transform:scale(1.06)}
  100%{transform:scale(1)}
}

/* SPEECH */
.speech{
  position:absolute;
  bottom:18vh;
  left:50%;
  transform:translateX(-50%);
  padding:14px 24px;
  background:rgba(0,0,0,.8);
  border-radius:28px;
  font-size:16px;
  font-style:italic;
  color:var(--rose-soft);
  max-width:90vw;
  text-align:center;
  opacity:0;
  transition:opacity .6s;
}
.speech.show{opacity:1}

/* MENU */
.menu{
  position:absolute;
  bottom:calc(env(safe-area-inset-bottom) + 12px);
  width:100%;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
}
.menu button{
  padding:14px;
  min-width:60px;
  font-size:1.6rem;
  border:none;
  border-radius:16px;
  background:linear-gradient(135deg,#ff6fae,#ff9ac8);
  color:#000;
  box-shadow:0 0 14px rgba(255,154,200,.4);
}

/* HELP */
.help{
  position:absolute;
  bottom:calc(env(safe-area-inset-bottom) + 70px);
  width:100%;
  text-align:center;
  font-size:12px;
  letter-spacing:.28em;
  color:var(--ink-dim);
}

/* AUDIO TOGGLE */
.audio{
  position:fixed;
  right:14px;
  top:14px;
  font-size:11px;
  letter-spacing:.2em;
  opacity:.9;
}
</style>
</head>

<body>

<div class="audio" id="audioBtn">ğŸ”‡ NALA</div>

<div class="header">
  <div class="sup">THE STAR IS</div>
  <h1>ONLY<span>Q</span></h1>
  <div class="sub" id="modeLabel">FOCUS Â· SOLO</div>
</div>

<div class="scene">
  <div class="grid solo" id="grid"></div>
  <div class="speech" id="speech">Respireâ€¦</div>
</div>

<div class="help">Swipe â† â†’ changer mode Â· Tap emoji = prÃ©sence</div>

<div class="menu">
  <button>ğŸ«¦</button>
  <button>ğŸ’“</button>
  <button>ğŸ”¥</button>
  <button>ğŸ‘ï¸</button>
  <button>ğŸŒŠ</button>
</div>

<audio id="nalaAudio" loop>
  <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_9b5d8e4e2a.mp3">
</audio>

<script>
/* ===== GRID / MODES ===== */
const grid = document.getElementById('grid');
const label = document.getElementById('modeLabel');
const speech = document.getElementById('speech');
const audio = document.getElementById('nalaAudio');
const btn = document.getElementById('audioBtn');

let mode = 0;
let audioOn = false;

const modes = [
 {cls:'solo', txt:'FOCUS Â· SOLO', n:1},
 {cls:'duo',  txt:'SYNCHRO Â· DUO', n:2},
 {cls:'quad', txt:'SURCHARGE Â· QUAD', n:4}
];

const sigils = ['ğŸ«¦','ğŸ’“','ğŸ”¥','ğŸ‘ï¸','ğŸŒŠ'];

function render(){
 const m = modes[mode];
 grid.className = 'grid ' + m.cls;
 grid.innerHTML = '';
 for(let i=0;i<m.n;i++){
  grid.innerHTML += `<div class="node">${sigils[i % sigils.length]}</div>`;
 }
 label.textContent = m.txt;
}

/* ===== AUDIO ===== */
function toggleAudio(){
 audioOn = !audioOn;
 if(audioOn){
  audio.volume = 0.15;
  audio.play().catch(()=>{});
  btn.textContent = 'ğŸ”Š NALA';
 }else{
  audio.pause();
  btn.textContent = 'ğŸ”‡ NALA';
 }
}
btn.onclick = toggleAudio;

/* ===== NALA VOICE (ROBUST) ===== */
const nalaLines = [
  "Respireâ€¦",
  "Reste lÃ .",
  "Laisse faire.",
  "Plus lentement.",
  "Ne pense pas.",
  "Je suis avec toi."
];

let nalaVoices = [];
speechSynthesis.onvoiceschanged = () => {
  nalaVoices = speechSynthesis.getVoices();
};

function speakNala(){
 if(!('speechSynthesis' in window)) return;

 // Doit Ãªtre dÃ©clenchÃ© par action utilisateur
 speechSynthesis.cancel();

 const text = nalaLines[Math.floor(Math.random()*nalaLines.length)];
 const u = new SpeechSynthesisUtterance(text);

 u.lang = 'fr-FR';
 u.rate = 0.75;
 u.pitch = 0.9;
 u.volume = 1;

 const voice =
   nalaVoices.find(v => v.lang.startsWith('fr') && v.name.toLowerCase().includes('female')) ||
   nalaVoices.find(v => v.lang.startsWith('fr')) ||
   nalaVoices[0];

 if(voice) u.voice = voice;

 speech.textContent = text;
 speech.classList.add('show');
 setTimeout(()=>speech.classList.remove('show'),2000);

 speechSynthesis.speak(u);
}

/* ===== MENU ACTIONS ===== */
document.querySelectorAll('.menu button').forEach(b=>{
 b.onclick = ()=>{
  if(!audioOn) toggleAudio(); // autorise l'audio
  speakNala();               // Nala parle
 };
});

/* ===== SWIPE MODES ===== */
let sx = 0;
document.addEventListener('touchstart',e=>sx=e.touches[0].clientX);
document.addEventListener('touchend',e=>{
 const dx = e.changedTouches[0].clientX - sx;
 if(Math.abs(dx)>40){
  mode = (mode + (dx<0?1:-1) + modes.length) % modes.length;
  render();
 }
});

/* INIT */
render();
</script>

</body>
</html>
